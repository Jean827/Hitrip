# æµ·å—æ–‡æ—…å¹³å°éƒ¨ç½²æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æµ·å—æ–‡æ—…å¹³å°çš„éƒ¨ç½²æµç¨‹ï¼ŒåŒ…æ‹¬ç¯å¢ƒè¦æ±‚ã€é…ç½®æ­¥éª¤ã€éƒ¨ç½²æ–¹æ³•å’Œç»´æŠ¤æŒ‡å—ã€‚

## ğŸ–¥ï¸ ç³»ç»Ÿè¦æ±‚

### æœåŠ¡å™¨è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04+ / CentOS 8+ / macOS 12+
- **CPU**: 2æ ¸å¿ƒä»¥ä¸Š
- **å†…å­˜**: 4GBä»¥ä¸Š
- **å­˜å‚¨**: 20GBä»¥ä¸Šå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„ç½‘ç»œè¿æ¥

### è½¯ä»¶è¦æ±‚
- **Node.js**: 18.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm**: 9.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **PostgreSQL**: 13.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **Redis**: 6.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **Docker**: 20.x æˆ–æ›´é«˜ç‰ˆæœ¬ (å¯é€‰)
- **Docker Compose**: 2.x æˆ–æ›´é«˜ç‰ˆæœ¬ (å¯é€‰)

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ä½¿ç”¨ Docker Compose (æ¨è)

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/your-org/hitrip.git
cd hitrip
```

2. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp backend/env.example backend/.env
cp frontend/env.example frontend/.env
```

ç¼–è¾‘ `backend/.env`:
```env
# æ•°æ®åº“é…ç½®
DB_HOST=postgres
DB_PORT=5432
DB_NAME=hitrip
DB_USER=hitrip_user
DB_PASSWORD=your_secure_password

# Redisé…ç½®
REDIS_HOST=redis
REDIS_PORT=6379

# JWTé…ç½®
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRES_IN=24h

# æœåŠ¡å™¨é…ç½®
PORT=3001
NODE_ENV=production

# æ”¯ä»˜é…ç½®
WECHAT_APP_ID=your_wechat_app_id
WECHAT_MCH_ID=your_wechat_mch_id
WECHAT_API_KEY=your_wechat_api_key
ALIPAY_APP_ID=your_alipay_app_id
ALIPAY_PRIVATE_KEY=your_alipay_private_key
ALIPAY_PUBLIC_KEY=your_alipay_public_key

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_PATH=/uploads
MAX_FILE_SIZE=10485760

# é‚®ä»¶é…ç½®
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASS=your_email_password

# çŸ­ä¿¡é…ç½®
SMS_PROVIDER=aliyun
SMS_ACCESS_KEY=your_sms_access_key
SMS_SECRET_KEY=your_sms_secret_key
SMS_SIGN_NAME=your_sms_sign_name
SMS_TEMPLATE_CODE=your_sms_template_code
```

ç¼–è¾‘ `frontend/.env`:
```env
VITE_API_BASE_URL=http://localhost:3001/api
VITE_APP_TITLE=æµ·å—æ–‡æ—…å¹³å°
VITE_APP_DESCRIPTION=æµ·å—æ–‡æ—…ç»¼åˆæœåŠ¡å¹³å°
```

3. **å¯åŠ¨æœåŠ¡**
```bash
docker-compose up -d
```

4. **åˆå§‹åŒ–æ•°æ®åº“**
```bash
docker-compose exec backend npm run db:migrate
docker-compose exec backend npm run db:seed
```

5. **è®¿é—®åº”ç”¨**
- å‰ç«¯: http://localhost:3000
- åç«¯API: http://localhost:3001
- APIæ–‡æ¡£: http://localhost:3001/api-docs

## ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²

### 1. ç¯å¢ƒå‡†å¤‡

#### å®‰è£… Node.js
```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# CentOS/RHEL
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs

# macOS
brew install node@18
```

#### å®‰è£… PostgreSQL
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y postgresql postgresql-contrib

# CentOS/RHEL
sudo yum install -y postgresql-server postgresql-contrib
sudo postgresql-setup initdb
sudo systemctl start postgresql
sudo systemctl enable postgresql

# macOS
brew install postgresql
brew services start postgresql
```

#### å®‰è£… Redis
```bash
# Ubuntu/Debian
sudo apt-get install -y redis-server

# CentOS/RHEL
sudo yum install -y redis
sudo systemctl start redis
sudo systemctl enable redis

# macOS
brew install redis
brew services start redis
```

### 2. æ•°æ®åº“é…ç½®

#### åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
```sql
-- è¿æ¥åˆ°PostgreSQL
sudo -u postgres psql

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE hitrip;

-- åˆ›å»ºç”¨æˆ·
CREATE USER hitrip_user WITH PASSWORD 'your_secure_password';

-- æˆæƒ
GRANT ALL PRIVILEGES ON DATABASE hitrip TO hitrip_user;

-- é€€å‡º
\q
```

### 3. åç«¯éƒ¨ç½²

#### å®‰è£…ä¾èµ–
```bash
cd backend
npm install
```

#### é…ç½®ç¯å¢ƒå˜é‡
```bash
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ç­‰ä¿¡æ¯
```

#### æ•°æ®åº“è¿ç§»
```bash
npm run db:migrate
npm run db:seed
```

#### å¯åŠ¨æœåŠ¡
```bash
# å¼€å‘ç¯å¢ƒ
npm run dev

# ç”Ÿäº§ç¯å¢ƒ
npm run build
npm start

# ä½¿ç”¨PM2 (æ¨è)
npm install -g pm2
pm2 start ecosystem.config.js
```

### 4. å‰ç«¯éƒ¨ç½²

#### å®‰è£…ä¾èµ–
```bash
cd frontend
npm install
```

#### æ„å»ºé¡¹ç›®
```bash
npm run build
```

#### éƒ¨ç½²é™æ€æ–‡ä»¶
```bash
# ä½¿ç”¨ nginx
sudo apt-get install -y nginx
sudo cp -r dist/* /var/www/html/
sudo systemctl restart nginx

# æˆ–ä½¿ç”¨å…¶ä»–é™æ€æ–‡ä»¶æœåŠ¡å™¨
npm install -g serve
serve -s dist -l 3000
```

## ğŸ”’ å®‰å…¨é…ç½®

### 1. é˜²ç«å¢™é…ç½®
```bash
# Ubuntu/Debian
sudo ufw enable
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 3001

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=22/tcp
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --permanent --add-port=3001/tcp
sudo firewall-cmd --reload
```

### 2. SSLè¯ä¹¦é…ç½®
```bash
# å®‰è£… Certbot
sudo apt-get install -y certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œ
0 12 * * * /usr/bin/certbot renew --quiet
```

### 3. æ•°æ®åº“å®‰å…¨
```bash
# ä¿®æ”¹PostgreSQLé…ç½®
sudo nano /etc/postgresql/13/main/postgresql.conf

# æ·»åŠ ä»¥ä¸‹é…ç½®
listen_addresses = 'localhost'
max_connections = 100
shared_buffers = 256MB
effective_cache_size = 1GB

# ä¿®æ”¹è®¿é—®æ§åˆ¶
sudo nano /etc/postgresql/13/main/pg_hba.conf

# æ·»åŠ ä»¥ä¸‹è¡Œ
local   hitrip          hitrip_user                           md5
host    hitrip          hitrip_user           127.0.0.1/32    md5
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. åº”ç”¨ç›‘æ§
```bash
# å®‰è£…PM2ç›‘æ§
pm2 install pm2-logrotate
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 30

# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status
pm2 logs
pm2 monit
```

### 2. ç³»ç»Ÿç›‘æ§
```bash
# å®‰è£…htop
sudo apt-get install -y htop

# å®‰è£…iotop
sudo apt-get install -y iotop

# å®‰è£…nethogs
sudo apt-get install -y nethogs
```

### 3. æ—¥å¿—ç®¡ç†
```bash
# é…ç½®logrotate
sudo nano /etc/logrotate.d/hitrip

# æ·»åŠ ä»¥ä¸‹é…ç½®
/var/log/hitrip/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    postrotate
        pm2 reloadLogs
    endscript
}
```

## ğŸ”„ å¤‡ä»½å’Œæ¢å¤

### 1. æ•°æ®åº“å¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
sudo nano /usr/local/bin/backup_hitrip.sh

#!/bin/bash
BACKUP_DIR="/backup/hitrip"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="hitrip"
DB_USER="hitrip_user"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
pg_dump -U $DB_USER $DB_NAME > $BACKUP_DIR/hitrip_$DATE.sql

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip $BACKUP_DIR/hitrip_$DATE.sql

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "hitrip_*.sql.gz" -mtime +7 -delete

echo "Backup completed: hitrip_$DATE.sql.gz"
```

```bash
# è®¾ç½®æ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/backup_hitrip.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œ (æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½)
0 2 * * * /usr/local/bin/backup_hitrip.sh
```

### 2. æ–‡ä»¶å¤‡ä»½
```bash
# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
sudo tar -czf /backup/hitrip/uploads_$(date +%Y%m%d_%H%M%S).tar.gz /var/www/uploads/

# å¤‡ä»½é…ç½®æ–‡ä»¶
sudo tar -czf /backup/hitrip/config_$(date +%Y%m%d_%H%M%S).tar.gz /path/to/config/files/
```

### 3. æ¢å¤æ•°æ®
```bash
# æ¢å¤æ•°æ®åº“
gunzip -c /backup/hitrip/hitrip_20240101_120000.sql.gz | psql -U hitrip_user hitrip

# æ¢å¤æ–‡ä»¶
sudo tar -xzf /backup/hitrip/uploads_20240101_120000.tar.gz -C /
```

## ğŸš¨ æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜

#### æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥PostgreSQLæœåŠ¡çŠ¶æ€
sudo systemctl status postgresql

# æ£€æŸ¥è¿æ¥é…ç½®
sudo nano /etc/postgresql/13/main/postgresql.conf
sudo nano /etc/postgresql/13/main/pg_hba.conf

# é‡å¯PostgreSQL
sudo systemctl restart postgresql
```

#### åº”ç”¨æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :3001

# æ£€æŸ¥æ—¥å¿—
pm2 logs
tail -f /var/log/hitrip/error.log

# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $NODE_ENV
echo $DB_HOST
```

#### å†…å­˜ä¸è¶³
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
top

# ä¼˜åŒ–Node.jså†…å­˜
export NODE_OPTIONS="--max-old-space-size=2048"

# é‡å¯åº”ç”¨
pm2 restart all
```

### 2. æ€§èƒ½ä¼˜åŒ–

#### æ•°æ®åº“ä¼˜åŒ–
```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_products_category ON products(category_id);
CREATE INDEX idx_orders_user ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_payments_order ON payments(order_id);

-- åˆ†ææŸ¥è¯¢æ€§èƒ½
EXPLAIN ANALYZE SELECT * FROM products WHERE category_id = '1';
```

#### åº”ç”¨ä¼˜åŒ–
```bash
# å¯ç”¨gzipå‹ç¼©
npm install compression

# å¯ç”¨ç¼“å­˜
npm install redis

# ä¼˜åŒ–é™æ€æ–‡ä»¶
npm install -g imagemin
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»ä¿¡æ¯
- **æŠ€æœ¯æ”¯æŒé‚®ç®±**: support@hitrip.com
- **ç´§æ€¥è”ç³»ç”µè¯**: 400-123-4567
- **å·¥ä½œæ—¶é—´**: å‘¨ä¸€è‡³å‘¨äº” 9:00-18:00

### æ—¥å¿—æ”¶é›†
```bash
# æ”¶é›†ç³»ç»Ÿä¿¡æ¯
uname -a
cat /etc/os-release
free -h
df -h

# æ”¶é›†åº”ç”¨æ—¥å¿—
pm2 logs --lines 100
tail -n 100 /var/log/hitrip/error.log

# æ”¶é›†æ•°æ®åº“æ—¥å¿—
tail -n 100 /var/log/postgresql/postgresql-13-main.log
```

### æ›´æ–°å’Œç»´æŠ¤
```bash
# æ›´æ–°ä»£ç 
git pull origin main

# æ›´æ–°ä¾èµ–
npm install

# é‡å¯æœåŠ¡
pm2 restart all

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status
```

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] ç¯å¢ƒè¦æ±‚æ£€æŸ¥
- [ ] æ•°æ®åº“é…ç½®å®Œæˆ
- [ ] ç¯å¢ƒå˜é‡é…ç½®å®Œæˆ
- [ ] åº”ç”¨å¯åŠ¨æˆåŠŸ
- [ ] æ•°æ®åº“è¿ç§»å®Œæˆ
- [ ] åˆå§‹æ•°æ®å¯¼å…¥å®Œæˆ
- [ ] é˜²ç«å¢™é…ç½®å®Œæˆ
- [ ] SSLè¯ä¹¦é…ç½®å®Œæˆ
- [ ] ç›‘æ§ç³»ç»Ÿé…ç½®å®Œæˆ
- [ ] å¤‡ä»½ç­–ç•¥é…ç½®å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ

---

**éƒ¨ç½²å®Œæˆæ—¶é—´**: ___________  
**éƒ¨ç½²äººå‘˜**: ___________  
**éƒ¨ç½²ç‰ˆæœ¬**: ___________  
**å¤‡æ³¨**: ___________ 